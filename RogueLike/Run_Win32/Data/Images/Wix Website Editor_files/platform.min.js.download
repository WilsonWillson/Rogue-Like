define("platform/common/constants",[],function(){"use strict";return{EDITOR_API_NS:"editorAPI",PLATFORM_PANEL:"PLATFORM_PANEL",PLATFORM_ON_EVENT:"PLATFORM_ON_EVENT",PLATFORM_SDK_ALIVE:"PLATFORM_SDK_ALIVE",PLATFORM_SDK_READY:"PLATFORM_SDK_READY",CONTROLLER_COMPONENT_TYPE:"platform.components.AppController",TPA_WIDGET_TYPE_TEMPLATE:{qname:{prefix:"$w",shortName:"IFrame"},componentType:"wysiwyg.viewer.components.tpapps.TPAWidget",tagName:"",members:null,events:null,baseTypes:{},inheritanceChain:null},ACTION_CONNECT:"connect",EVENTS:{controllerSettingsButtonClicked:"controllerSettingsButtonClicked",componentConnectButtonClicked:"componentConnectButtonClicked",createCollectionButtonClicked:"openCreateNewCollection",formBuilderAppClicked:"formBuilderAppClicked"},panelTypes:{COMPONENT_PANEL:"componentPanel",FULL_STAGE:"fullStagePanel",MODAL:"modalPanel",TOOL:"toolPanel",TOOL_BAR:"toolBarPanel"},pages:{page_settings:{layout:{type:"Pages_Layouts_Tab_Title",title:"Pages_Layouts_Tab_Title"},permissions:{type:"Pages_Permissions_Tab_Title",title:"Pages_Permissions_Tab_Title"},pageInfo:{type:"page_info"},seo:{type:"seo"}},page_actions:{rename:{title:"Pages_Actions_Page_Rename",type:"Pages_Actions_Page_Rename",icon:"quickActionsRename"}}},members:{router_actions:{view_site_members:{title:"Pages_Panel_MemberMenu_SiteMembers_Link",type:"view_site_members",icon:"goToURLAction"},open_signup_settings:{title:"Pages_Panel_MemberMenu_SignupSettings_Link",type:"open_signup_settings",icon:"membersAction"}}},controller:{DEFAULT_STATE:"default"}}}),define("platform/bi/events.json",[],function(){return{CONTROLLER_GFPP_CLICK:{evid:26,src:79,endpoint:"platform",fields:{app_name:"string",action_name:"string",controller_type:"string",component_id:"string",pageId:"string"}},page_delete_dataset:{evid:91,src:79,endpoint:"platform",fields:{app_name:"string",controller_type:"string",component_id:"string",pageId:"string"}}}}),define("platform/appController/controllerSettingsGfpp",["lodash","platform/common/constants","platform/bi/events.json"],function(e,t,n){"use strict";function o(t,n){var o=e.get(t.platform.controllers.getStageData(e.head(n)),"mainAction.label");return e.isNil(o)?r:o}var i={dataset:"7f921134-acd3-4771-ac24-33bbeafefb90",router_dataset:"7f921134-acd3-4771-ac24-33bbeafefb90"},r="Manage Dataset",a={mainActions:[{label:o,shouldTranslate:!1,onClick:function(i,r){var a=e.head(r),c=i.components.data.get(a),p=t.EVENTS.controllerSettingsButtonClicked,s=i.documentServices.platform.controllers.settings.get(a),l=i.documentServices.platform.controllers.getName(a),u={controllerRef:a,controllerConfig:s,controllerType:c.controllerType,controllerDisplayName:l,origin:"gfpp"};i.bi.event(n.CONTROLLER_GFPP_CLICK,{action_name:o(i,r),app_name:c.applicationId,controller_type:c.controllerType,component_id:a.id,pageId:i.pages.getCurrentPageId()});var d=i.documentServices.platform.getAppDataByAppDefId(c.applicationId);i.documentServices.platform.notifyApplication(d.applicationId,{eventType:p,eventPayload:u})}}],presetActions:{help:{helpId:function(e,t){var n=e.components.data.get(t).controllerType;return i[n]||"3c9b0528-699b-475f-818c-2123885cb11f"}}}};return{init:function(e,t){a.enabledActions=[t.HELP],e("AppController",a)}}}),define("platform/appController/appController",["lodash","platform/appController/controllerSettingsGfpp","platform/bi/events.json"],function(e,t,n){"use strict";function o(t,n){var o,i=e.reduce(n,function(e,n){return t.components.is.container(n)?e.concat(n,t.components.get.byAncestor(n)):e.concat(n)},[]);return e.some(i,function(n){var r=t.documentServices.platform.controllers.connections.get(n);return!e.isEmpty(r)&&function(n){return o=o||e.keyBy(i,"id"),e(n).map("controllerRef").some(function(e){var n=e.id;return!o[n]&&t.components.getPage(e).id!==t.pages.getMasterPageId()})}(r)})}function i(t,n,i){function r(n){t.panelManager.openPanel("platform.panels.warnForDisconnectedComponentsPanel",e.assign({undo:t.history.undo},n))}n=e.isArray(n)?n:[n];var a=t.components.isShowOnAllPages(n),c=t.components.isShowOnAllPages(i);a&&!c&&function(t,n){return e(n).reduce(function(e,n){return t.components.is.container(n)?e.concat(n,t.components.get.byAncestor(n)):e.concat(n)},[]).some(function(e){return"platform.components.AppController"===t.components.getType(e)})}(t,n)&&r({controllerComp:!0}),!a&&c&&o(t,n)&&r({connectedComps:!0})}function r(e,o,r){return t.init(o,r),e.registerCannotRemovePlugin("platform.components.AppController",function(e,t){var o=e.components.data.get(t);e.bi.event(n.page_delete_dataset,{app_name:o.applicationId,controller_type:o.controllerType,controller_id:t.id,pageId:e.documentServices.pages.getPrimaryPageId()})}.bind(null,e)),e.editorEventRegistry.register(e.editorEventRegistry.constants.events.SET_CONTAINER_BEFORE,i),this}return{init:r}}),define("platform/common/utils",["lodash","util"],function(e,t){"use strict";return{getPanelName:function(e){return"platformPanels."+e},getFullApplicationUrl:function(n,o,i,r){var a=e.chain(window.location.search.substr(1)).thru(t.url.parseUrlParams).get("editorPlatformAppSources","").split(",").invokeMap("split",":").fromPairs().value();if(e.startsWith(o,"http"))return t.url.setUrlParam(o,"applicationId",r);var c=function(o){var r=n.documentServices.platform.getAppDataByAppDefId(i),a=e.get(r,"appFields.platform.editorScriptUrl");if(a)return a;var c=e.get(r,"editorArtifact");return c?o?t.url.joinURL(t.serviceTopology.scriptsDomainUrl,"services",c,o):t.serviceTopology.scriptsLocationMap[c]:void 0}(a[i]);if(c){var p=new URL(o,c).href;return t.url.setUrlParam(p,"applicationId",r)}}}}),define("platform/connection/connectableComponentsConfig",["lodash","experiment"],function(e,t){"use strict";var n=["WRichText","Image","MatrixGallery","PaginatedGridGallery","SliderGallery","SlideShowGallery","SiteButton","TextInput","TextAreaInput","Checkbox","RadioButton","RadioGroup","OptionsListInput","WPhoto","ImageButton","ComboBoxInput","Grid","DatePicker"],o=["Impress","Masonry","Thumbnails","StripSlideshow","StripShowcase","Accordion","Freestyle","Collage","Honeycomb","SlideShowGallery","TPA3DGallery","TPA3DCarousel"];return{getConnectableComponents:function(){return t.isOpen("se_addConnectButtonToTpaGalleries")&&(n=[].concat(n,o)),t.isOpen("se_addFileUploaderConnect")&&(n=[].concat(n,["FileUploader"])),t.isOpen("se_addSocialVideoPlayerConnect")&&(n=[].concat(n,["Video"])),t.isOpen("se_addColumnConnect")&&(n=[].concat(n,["Column"])),t.isOpen("se_addPageConnect")&&(n=[].concat(n,["Page"])),[].concat(n)}}}),define("platform/connection/connectableComponents",["lodash","platform/common/constants","platform/connection/connectableComponentsConfig"],function(e,t,n){"use strict";var o={enabledActions:[t.ACTION_CONNECT]};return{registerGfpp:function(e){n.getConnectableComponents().forEach(function(t){e(t,o)})}}}),define("platform/connection/connection",["lodash","coreUtilsLib","platform/common/constants","platform/common/utils","platform/connection/connectableComponents"],function(e,t,n,o,i){"use strict";function r(t,n){var o=t.documentServices.platform.controllers.connections.get(e.head(n)),i=!1;return e.forEach(o,function(e){"ConnectionItem"===e.type&&(i=!0)}),i}function a(o,i){var r=o.documentServices.platform.getInstalledAppsData(),a=1===r.length?e.head(r):"multiple application ids provided - TODO",c=e.head(i),p=n.EVENTS.componentConnectButtonClicked,s={componentRef:c,componentType:o.components.getType(c),componentSdkType:o.wixCode.getCompSdkType(c),origin:"gfpp"};o.documentServices.platform.notifyApplication(a.applicationId,{eventType:p,eventPayload:t.objectUtils.cloneDeep(s)})}var c={connect:{isSelected:function(t){var i=o.getPanelName(n.panelTypes.COMPONENT_PANEL);return e.some(t.panelManager.getOpenPanels(),{name:i})},isApplied:r,tooltip:"gfpp_component_connect",tooltip_active:"gfpp_component_connected_to_controllers",icon:"connect",rightClickMenuLabel:"PLATFORM_RightClick_Menu_Connect",className:function(e,t){return r(e,t)?"connected":""},onClick:a}};return{init:function(e,t){return e(c),i.registerGfpp(t),this},notifyConnectButtonClicked:a}}),define("platform/api/controllers/controllers",["lodash"],function(e){"use strict";function t(e,t,o){o=e.platform.getAppDataByApplicationId(o.applicationId);var i=t?t.id:null;return e.documentServices.components.getAllComponents(i,function(t){return e.components.getType(t)===n&&o.appDefinitionId===e.components.data.get(t).applicationId})}var n="platform.components.AppController";return{getAllCollections:function(){},listControllers:function(n,o,i,r){var a=t(n,e.get(r,"pageRef")||n.pages.getFocusedPage(),o);return e.map(a,function(e){return{controllerRef:e}})},listAllControllers:function(n,o){var i=t(n,null,o);return e.map(i,function(e){return{controllerRef:e}})},listConnectableControllers:function(n,o,i,r){var a=t(n,n.components.getPage(r.componentRef),o);return e.map(a,function(e){return{controllerRef:e}})},getControllerConnections:function(e,t,n,o){return e.documentServices.platform.controllers.connections.getControllerConnections(o.controllerRef)},listConnections:function(t,n,o,i){var r=t.documentServices.platform.controllers.connections.get(i.componentRef);return e.reject(r,{type:"WixCodeConnectionItem"})},listConnectedComponents:function(e,t,n,o){return e.documentServices.platform.controllers.connections.getConnectedComponents(o.controllerRef)},connect:function(t,n,o,i){return t.documentServices.platform.controllers.connections.connect(i.connectToRef,i.controllerRef,i.role,i.connectionConfig),e.pick(i,"connectToRef","controllerRef","role")},disconnect:function(e,t,n,o){e.documentServices.platform.controllers.connections.disconnect(o.connectToRef,o.controllerRef,o.role)},getData:function(t,n,o,i){var r=t.documentServices.platform.controllers.settings.get(i.controllerRef);return{type:e.get(t.components.data.get(i.controllerRef),"controllerType"),config:r,displayName:t.documentServices.platform.controllers.getName(i.controllerRef)}},saveConfiguration:function(e,t,n,o){return e.documentServices.platform.controllers.settings.set(o.controllerRef,o.config),new Promise(e.documentServices.waitForChangesApplied)},setDisplayName:function(e,t,n,o){return e.documentServices.platform.controllers.setName(o.controllerRef,o.name),new Promise(e.documentServices.waitForChangesApplied)},setState:function(e,t,n,o){return e.documentServices.platform.controllers.setState(o.state),new Promise(e.documentServices.waitForChangesApplied)}}}),define("platform/services/tokenService",["lodash"],function(e){"use strict";return{generatePanelToken:function(t){return e.uniqueId("platform_"+t+"_")},generateStaticGlobalPanelToken:function(t){return e.uniqueId("platform_"+t)}}}),define("platform/api/editor/utils/utils",["util"],function(e){"use strict";return{getLinkAsString:function(t,n,o,i){return e.link.getLinkValueAsString(t,i.link)}}}),define("platform/api/editor/editor",["lodash","jquery","pmrpc","constants","platform/common/constants","platform/common/utils","platform/services/tokenService","platform/api/editor/utils/utils","stateManagement"],function(e,t,n,o,i,r,a,c,p){"use strict";function s(n,o,a,c){var p=l(n,o,c),s=r.getPanelName(i.panelTypes.TOOL),u=function(n,o){o=o||{};var i=n.panelManager.getOpenPanels(),r=e.find(i,{type:"platform"});if(r){var a=t('[name="'+r.token+'"]');if(a){var c=a.offset();if(c&&e.isNumber(c.top)&&e.isNumber(c.left)){if(e.isNumber(o.x)&&e.isNumber(o.y))return{top:c.top+o.y,left:c.left+o.x};if(e.isNumber(o.height)&&e.get(r,"props.height")&&e.get(r,"props.width"))return{top:c.top+r.props.height/2-o.height/2,left:c.left+r.props.width/2}}}}return{top:"25%",left:"45%"}}(n,c);return e.merge(p,u),new Promise(function(e){n.panelManager.openPlatformPanel({panelName:s,panelProps:p,panelMetaData:{resolve:e}})})}function l(t,n,o){var i=t.documentServices.platform.getAppDataByApplicationId(n.applicationId),c=e.assign({token:a.generatePanelToken(i.appDefinitionId)},o);return o.url&&e.assign(c,{url:r.getFullApplicationUrl(t,o.url,i.appDefinitionId,i.applicationId)}),c}function u(t,n,o,i){var r=function(t,n){return e.find(t.panelManager.getOpenPanels(),{token:n})}(t,o);if(r){var a=l(t,n,i);a.token=o,t.panelManager.updatePanelProps(r.name,a)}}var d={IMAGE:function(e){return{uri:e.uri,title:e.title,width:e.width,height:e.height}},DOCUMENT:function(e){return{uri:e.uri,title:e.title}},VIDEO:function(t){var n=function(t){var n=Math.floor(t.length/2)-(1-t.length%2);return e.nth(t,n)}(t.fileOutput.image);return{id:t.id,title:t.title,posterUri:n&&n.url,posterWidth:n&&n.width,posterHeight:n&&n.height}}};return{openPanel:function(e,t,n,o,i){e.panelManager.openPanel(n,o,i)},openComponentPanel:function(e,t,n,a){var c=l(e,t,a);e.selection.selectComponentByCompRef(a.componentRef),e.panelManager.openPlatformPanel({panelName:r.getPanelName(i.panelTypes.COMPONENT_PANEL),panelProps:c,panelMetaData:{frameType:o.PANEL_TYPES.COMP,closeAllOtherPanels:!0}})},openModalPanel:function(e,t,n,o){var a=l(e,t,o);return new Promise(function(t){e.panelManager.openPlatformPanel({panelName:r.getPanelName(i.panelTypes.MODAL),panelProps:a,panelMetaData:{resolve:t}})})},openToolPanel:s,openPagePanel:function(t,n,o,i){var r=t.documentServices.pages.getPagesData(),a=i.pageRef.id,c=t.pages.dynamicPages.getMenuItems(),p=e.flatMap(c,"items"),s=t.mainMenu.getMenuItemsFlattened(r),l=e.find(s,["pageData.id",a])||e.find(p,{id:a}),u=t.pages.dynamicPages.getDynamicPageActions(a,"pageSettings")||[],d={menuItemToShowSettingsFor:l,selectedSettingsTab:e.isEmpty(u)?null:u[0].title};t.navigateAndOpenPagesPanel(a,d)},openFullStagePanel:function(e,t,n,a){var c=l(e,t,a);e.panelManager.openPlatformPanel({panelName:r.getPanelName(i.panelTypes.FULL_STAGE),panelProps:c,panelMetaData:{frameType:o.PANEL_TYPES.FULL_STAGE,closeAllOtherPanels:!0}})},openLinkPanel:function(t,n,o,i){return new Promise(function(n){var o={link:e.get(i,"value",null),callback:n,onCancelCallback:n};t.openLinkPanel(o)})},openMediaPanel:function(t,n,o,i){return i=e.defaults(i||{},{callOnCancel:!0,isMultiSelect:!0,mediaType:"IMAGE"}),new Promise(function(n){t.mediaServices.mediaManager.open(i.mediaType,{multiSelect:i.isMultiSelect,callback:function(t){var o;if(e.isEmpty(t))i.callOnCancel&&(o=null);else{e.isArray(t)||(t=[t]);var r=e.get(d,i.mediaType,d.IMAGE);o=t.map(r)}n(o)}})})},openHelpPanel:function(e,t,n,o){var i={component:e.selection.getSelectedComponentType(),learn_more:!1,panel_name:"platform"};e.panelManager.openHelpCenter(o.helpId,{origin:"platform"},i)},updatePanelOptions:u,closePanel:function(e,t,n,o){e.store.dispatch(p.panels.logic.closePlatformPanel(n,o))},setAppAPI:function(e,t){n.api.request(t.applicationId,{target:e.documentServices.platform.getAppsContainer()}).then(function(e){n.api.set(t.applicationId,e)})},save:function(e){return new Promise(function(t,n){e.saveManager.saveInBackground(function(){t()},n)})},utils:c}}),define("platform/api/preview/preview",[],function(){"use strict";return{navigateTo:function(e,t,n,o){return new Promise(function(t){e.documentServices.platform.pages.navigateTo(o.pageUrl,function(){e.preview.isInPreviewMode()?t():e.preview.togglePreview(t)})})}}}),define("platform/api/vfs/vfs",["lodash"],function(e){"use strict";function t(e){return{name:e.name,fullPath:e.location,isDirectory:e.directory}}return{listChildren:function(n,o,i,r){var a=n.wixCode.fileSystem,c=a.getVirtualDescriptor(r.path,!0);return a.getChildren(c).then(function(n){return e.map(n,t)})},readFile:function(e,t,n,o){var i=e.wixCode.fileSystem,r=i.getVirtualDescriptor(o.path,!1);return i.readFile(r)},writeFile:function(e,t,n,o){var i=e.wixCode.fileSystem,r=i.getVirtualDescriptor(o.path,!1);return i.writeFile(r,o.content)},flush:function(e){return e.wixCode.fileSystem.flush()}}}),define("platform/api/pages/pages",["lodash","util"],function(e,t){"use strict";return{navigateTo:function(t,n,o,i){var r=e.get(i.pageRef,"id");if(r)return new Promise(function(e){t.pages.navigateTo(r,function(){e()})})},getCurrent:function(e){return e.documentServices.pages.getReference(e.documentServices.pages.getFocusedPageId())},rename:function(e,n,o,i){var r=i.pageRef.id,a=t.validate.pageNameValidator(i.title);return a||e.pages.data.update(r,{title:i.title}),a},add:function(e,t,n,o){return new Promise(function(t){var n=e.pages.add(o.title,o.definition);e.pages.navigateTo(n.id,function(){t(n)})})},data:{get:function(t,n,o,i){var r=i.pageRef.id,a=t.pages.data.get(r);return e.pick(a,["title","hidePage","pageSecurity"])},update:function(e,t,n,o){var i=o.pageRef.id;e.pages.data.update(i,o.data)}},permissions:{hasPassword:function(e,t,n,o){var i=o.pageRef.id;return e.documentServices.pages.permissions.hasPassword(i)},updatePagePassword:function(e,t,n,o){var i=o.pageRef.id;e.documentServices.pages.permissions.updatePassword(i,o.plainPassword)},removePagePassword:function(e,t,n,o){var i=o.pageRef.id;e.documentServices.pages.permissions.removePassword(i)}}}}),define("platform/api/components/components",["lodash"],function(e){"use strict";function t(t,n,o,i){return new Promise(function(n,o){e.isEmpty(i.componentDefinition.componentType)&&o(new Error("componentDefinition must contain componentType"));var r=t.components.buildDefaultComponentStructure(i.componentDefinition.componentType);!function(t,n,o){var i=e.get(o,"pageRef.id")||t.documentServices.pages.getFocusedPageId(),r=t.pasteLogic.addContext.getPastePosition(t,n.layout,i);e.merge(n.layout,r)}(t,r,i),e.merge(r,i.componentDefinition);var a=t.components.add(i.pageRef,r,i.customId,void 0,"editorSdk",{showAddToHeaderPanel:i.showAddToHeaderPanel});t.documentServices.waitForChangesApplied(function(){t.components.is.exist(a)?n(a):o(new Error("Could not add component"))})})}return{add:t,remove:function(e,t,n,o){return new Promise(function(t){e.documentServices.components.remove(o.componentRef),e.documentServices.waitForChangesApplied(t)})},getAllComponents:function(e){return e.documentServices.components.getAllComponents()},getPage:function(e,t,n,o){return e.components.getPage(o.componentRef)},getById:function(e,t,n,o){return e.documentServices.components.get.byId(o.id)},getChildren:function(e,t,n,o){var i=o.componentRef;return e.documentServices.components.getChildren(i,o.recursive||!1)},getAncestors:function(e,t,n,o){return e.documentServices.components.getAncestors(o.componentRef)},getType:function(e,t,n,o){return e.documentServices.components.getType(o.componentRef)},get:function(t,n,o,i){var r=i.componentRefs,a=i.properties||[],c=e.compact(e.isArray(r)?r:[r]);return e.reduce(c,function(n,o){var i={componentRef:o},r=t.documentServices.components.serialize(o);if(e.assign(i,e.pick(r,a)),e.includes(a,"sdkType")&&(i.sdkType=t.wixCode.getCompSdkType(o)),e.includes(a,"connections")){var c=t.documentServices.platform.controllers.connections.get(o);i.connections=e.reject(c,{type:"WixCodeConnectionItem"})}return n.push(i),n},[])},properties:{get:function(e,t,n,o){return e.components.properties.get(o.componentRef)},update:function(e,t,n,o){e.components.properties.update(o.componentRef,o.props)}},data:{get:function(e,t,n,o){return e.components.data.get(o.componentRef)},update:function(e,t,n,o){e.components.data.update(o.componentRef,o.data,!0)}},layout:{get:function(e,t,n,o){return e.components.layout.get(o.componentRef)},update:function(e,t,n,o){return new Promise(function(t,n){try{e.documentServices.components.layout.update(o.componentRef,o.layout)}catch(e){n(e)}e.documentServices.waitForChangesApplied(t)})}},modes:{showComponentOnlyOnPagesGroup:function(e,t,n,o){return new Promise(function(t){e.documentServices.components.modes.showComponentOnlyOnPagesGroup(o.componentPointer,o.pagesGroupPointer),e.documentServices.waitForChangesApplied(t)})}}}}),define("platform/api/routers/routers",["lodash","util"],function(e,t){"use strict";function n(t,n,o,i){var r=t.documentServices.routers.get.byRef(i.routerRef),a=e.get(t.documentServices.platform.getAppDataByApplicationId(n.applicationId),"appDefinitionId");if(r&&a===r.appDefinitionId)return{id:r.id,prefix:r.prefix,config:r.config,pages:e(r.pages).invertBy().map(function(e,n){return{pageRef:t.documentServices.pages.getReference(n),pageRoles:e}}).value()}}function o(t,n,o,i){var r=e.get(t.documentServices.platform.getAppDataByApplicationId(n.applicationId),"appDefinitionId"),a=t.documentServices.routers.getRouterRef.byPrefix(i.prefix);if(!a)return a;var c=t.documentServices.routers.get.byRef(a);return c&&c.appDefinitionId===r?a:void 0}return{add:function(t,n,o,i){return new Promise(function(o,r){var a={appDefinitionId:e.get(t.documentServices.platform.getAppDataByApplicationId(n.applicationId),"appDefinitionId"),prefix:e.get(i,"prefix"),config:e.get(i,"config")};e.get(i,"group")&&(a.group=i.group);var c=t.documentServices.routers.add(a);t.documentServices.waitForChangesApplied(function(){t.documentServices.routers.get.byRef(c)?o(c):r(new Error("Could not add router"))})})},remove:function(t,n,o,i){var r=e.get(t.documentServices.platform.getAppDataByApplicationId(n.applicationId),"appDefinitionId"),a=t.documentServices.routers.get.byRef(i.routerRef);if(a&&a.appDefinitionId===r)return t.documentServices.routers.remove(i.routerRef)},get:n,getAll:function(t,i,r){var a=e.get(t.documentServices.platform.getAppDataByApplicationId(i.applicationId),"appDefinitionId");return e.map(t.documentServices.routers.get.byApp(a),function(e){var r=o(t,i,0,{prefix:e.prefix});return n(t,i,0,{routerRef:r})})},update:function(t,n,o,i){return new Promise(function(o){var r=e.get(t.documentServices.platform.getAppDataByApplicationId(n.applicationId),"appDefinitionId"),a=t.documentServices.routers.get.byRef(i.routerRef);a&&a.appDefinitionId===r&&(t.documentServices.routers.update(i.routerRef,i),t.documentServices.waitForChangesApplied(function(){o()}))})},getByPage:function(t,n,o,i){var r=e.get(t.documentServices.platform.getAppDataByApplicationId(n.applicationId),"appDefinitionId"),a=t.documentServices.routers.getRouterRef.byPage(i.pageRef);if(!a)return a;var c=t.documentServices.routers.get.byRef(a);return c&&c.appDefinitionId===r?a:void 0},getByPrefix:o,isValidPrefix:function(n,o,i,r){var a=e.get(o,"applicationId"),c=n.documentServices.routers.isValidPrefix(a,r.prefix);if(!c.valid){var p="";switch(c.message){case 1:p="DYNAMIC_PAGES_VALIDATION_PREFIX_CAN_NOT_BE_EMPTY";break;case 2:p="DYNAMIC_PAGES_VALIDATION_PREFIX_IS_TOO_LONG";break;case 3:p="DYNAMIC_PAGES_VALIDATION_PREFIX_IS_DUPLICATE_OF_URISEO";break;case 4:p="DYNAMIC_PAGES_VALIDATION_PREFIX_CONTAINS_INVALID_CHARCTERS";break;case 5:p="DYNAMIC_PAGES_VALIDATION_PREFIX_IS_FORBIDDEN_WORD";break;case 6:p="DYNAMIC_PAGES_VALIDATION_PREFIX_IS_IN_USE_BY_ANOTHER_APPLICATION"}c.message=t.translate(p)}return c},pages:{add:function(t,n,o,i){var r=e.get(t.documentServices.platform.getAppDataByApplicationId(n.applicationId),"appDefinitionId"),a=t.documentServices.routers.get.byRef(i.routerRef);if(a&&a.appDefinitionId===r)return t.documentServices.routers.pages.add(i.routerRef,i.pageTitle,i.pageRoles)},delete:function(t,n,o,i){return new Promise(function(o,r){var a=e.get(t.documentServices.platform.getAppDataByApplicationId(n.applicationId),"appDefinitionId"),c=t.documentServices.routers.get.byRef(i.routerRef);c&&c.appDefinitionId===a?t.pages.remove(i.pageRef.id,function(){o()},function(){r()},!1):r()})},connect:function(t,n,o,i){var r=e.get(t.documentServices.platform.getAppDataByApplicationId(n.applicationId),"appDefinitionId"),a=t.documentServices.routers.get.byRef(i.routerRef);if(a&&a.appDefinitionId===r)return t.documentServices.routers.pages.connect(i.routerRef,i.pageRef,i.pageRoles)},disconnect:function(t,n,o,i){var r=e.get(t.documentServices.platform.getAppDataByApplicationId(n.applicationId),"appDefinitionId"),a=t.documentServices.routers.get.byRef(i.routerRef);if(a&&a.appDefinitionId===r)return t.documentServices.routers.pages.disconnect(i.routerRef,i.pageRef)},move:function(t,n,o,i){var r=e.get(t.documentServices.platform.getAppDataByApplicationId(n.applicationId),"appDefinitionId"),a=t.documentServices.routers.get.byRef(i.fromRouterRef),c=t.documentServices.routers.get.byRef(i.toRouterRef);if(a&&c&&c.appDefinitionId===r&&a.appDefinitionId===r)return t.documentServices.routers.pages.move(i.pageRef,i.fromRouterRef,i.toRouterRef)},listConnectablePages:function(e){return e.documentServices.routers.pages.listConnectablePages()}}}}),define("platform/api/history/history",[],function(){"use strict";return{add:function(e,t,n,o){return new Promise(function(t){e.documentServices.waitForChangesApplied(function(){e.history.add(o.label),t()})})}}}),define("platform/api/ide/ide",["lodash"],function(e){"use strict";function t(e,t,n,o){return e.wixCode.collectionsTree.navigateToCollection(e,o.name)}function n(n,o,i,r){var a=r.path,c=n.wixCode.fileSystem.getRoots().schemas.location;if(function(t,n){return e.startsWith(n,t)&&e.endsWith(n,".json")}(c,a)){return t(n,0,0,{name:function(e,t){return t.replace(e,"").replace(".json","")}(c,r.path)})}return n.wixCode.fileTree.navigateToFile(n,r.path,e.pick(r,["functionName","caretOffset"]))}return{openFile:n,navigateToCollection:t,treePane:{isOpen:function(e){return e.developerMode.ui.treePane.isOpen()},toggle:function(e){return new Promise(function(t){e.developerMode.ui.treePane.toggle(function(){t()})})}}}}),define("platform/api/info/info",["lodash","util"],function(e,t){"use strict";function n(e,t){return["//",i(),"/my-account/sites/",e.documentServices.generalInfo.getMetaSiteId(),"/app/",t,"?referralInfo=editor"].join("")}function o(e){return["//",i(),"/my-account/sites/",e.documentServices.generalInfo.getMetaSiteId(),"/simple-app","?app=wixcode","&referralInfo=editor_platform"].join("")}function i(){var e=window.location.hostname.match(/editor\.(.*)/);return e?"www."+e[1]:"www.wix.com"}function r(e){return!e.documentServices.generalInfo.isFirstSave()}var a=window.mainLoaded||0;return{getDashboardUrl:function(t,i){return new Promise(function(a,c){var p=r(t),s=e.get(t.documentServices.platform.getAppDataByApplicationId(i.applicationId),"appDefinitionId");p?a(s===t.documentServices.platform.editorApps.DATA_BINDING.appDefId?o(t):n(t,s)):s===t.documentServices.platform.editorApps.DATA_BINDING.appDefId?t.saveManager.saveInBackground(function(){a(o(t))},c):t.saveManager.saveInBackground(function(){a(n(t,s))},c)})},getMetaSiteId:function(e){return e.documentServices.generalInfo.getMetaSiteId()},getEditorSessionId:function(){return t.editorSessionUtil.editorSessionId},getSiteId:function(e){return e.documentServices.generalInfo.getSiteId()},getEditorReadyTimestamp:function(){return e.now()-a},getEditorMode:function(e){return e.getDeviceType()},getAppDefinitionId:function(e,t){var n=t.applicationId;return e.documentServices.platform.getAppDataByApplicationId(n).appDefinitionId},isSitePublished:function(e){return e.documentServices.generalInfo.isSitePublished()},getLanguage:function(e){return e.documentServices.generalInfo.getLanguage()},isSiteSaved:r}}),define("platform/api/environment/environment",["util"],function(e){"use strict";return{getLocale:function(){return e.editorModel.languageCode}}}),define("platform/api/siteSegments/siteSegments",[],function(){"use strict";return{getFooter:function(e){return e.siteSegments.getFooter()},getHeader:function(e){return e.siteSegments.getHeader()},getPagesContainer:function(e){return e.siteSegments.getPagesContainer()},getSiteStructure:function(e){return e.siteSegments.getSiteStructure()}}}),define("platform/api/userPreferences/userPreferences",["lodash"],function(e){"use strict";return{site:{set:function(t,n,o,i){var r=e.get(t.documentServices.platform.getAppDataByApplicationId(n.applicationId),"appDefinitionId");if(!r)throw new Error("Illegal appData - application is not registered in clientSpecMap");e.forEach(i,function(e,n){t.userPreferences.site.set(n,e,r)})},get:function(t,n,o,i){var r=e.get(t.documentServices.platform.getAppDataByApplicationId(n.applicationId),"appDefinitionId");if(!r)throw new Error("Illegal appData - application is not registered in clientSpecMap");var a=e.isArray(i)?e(i).keyBy().mapValues(e.noop).value():i,c=e.mapValues(a,function(e,n){return t.userPreferences.site.get(n,r)});return e.defaults(c,a)}}}}),define("platform/api/tpa/tpa",["lodash"],function(e){"use strict";return{add:{application:function(t,n,o,i){return new Promise(function(n,o){e.get(i,"appDefinitionId")?t.tpa.addApplication(i.appDefinitionId,i).then(function(e){n(e)}).catch(function(e){o(e)}):o(new Error("options must contain appDefinitionId"))})},component:function(t,n,o,i){return new Promise(function(o,r){if((i=i||{}).componentType){if(i.appDefinitionId||(i.appDefinitionId=n.appDefinitionId),"WIDGET"===i.componentType){if(!e.isObject(i.widget))return void r(new Error("options must contain a widget object"));i.widget.tpaWidgetId=i.widget.widgetId}else if("PAGE"===i.componentType){if(!e.isObject(i.page))return void r(new Error("options must contain a page object"));if(i.page.isHidden&&!e.isBoolean(i.page.isHidden))return void r(new Error("isHidden param should be of type boolean"))}t.tpa.addComponent(i).then(function(e){o(e)}).catch(function(e){r(e)})}else r(new Error("options must contain componentType"))})}},isApplicationInstalled:function(t,n,o,i){return new Promise(function(n,o){e.get(i,"appDefinitionId")?n(t.documentServices.tpa.app.isInstalled(i.appDefinitionId)):o(new Error("options must contain appDefinitionId"))})},isAppSectionInstalled:function(t,n,o,i){return new Promise(function(o,r){if(e.get(i,"sectionId")){var a=n.applicationId;if(i.appDefinitionId){var c=t.documentServices.tpa.app.getDataByAppDefId(i.appDefinitionId);a=e.get(c,"applicationId")}o(t.documentServices.tpa.section.isSectionInstalledByTpaPageId(a,i.sectionId))}else r(new Error("options must contain sectionId"))})}}}),define("platform/api/language/language",[],function(){"use strict";return{add:function(e,t,n,o){e.documentServices.language.add(o.languageCode)},current:{set:function(e,t,n,o){e.documentServices.language.current.set(o.languageCode)}},multilingual:{init:function(e,t,n,o){e.documentServices.language.multilingual.init(o.languageCode)}}}}),define("platform/api/menu/menu",["lodash"],function(e){"use strict";return{create:function(t,n,o,i){return new Promise(function(o){var r=e.assign({appId:n.applicationId},i.menuData),a=t.documentServices.menu.create(r,i.customId);t.documentServices.waitForChangesApplied(function(){o(a)})})},connect:function(e,t,n,o){return new Promise(function(t){e.documentServices.menu.connect(o.menuCompPointer,o.menuId),e.documentServices.waitForChangesApplied(t)})},update:function(e,t,n,o){return new Promise(function(t){e.documentServices.menu.update(o.menuId,o.menuData),e.documentServices.waitForChangesApplied(t)})},remove:function(e,t,n,o){return new Promise(function(t){e.documentServices.menu.remove(o.menuId),e.documentServices.waitForChangesApplied(t)})},addItem:function(e,t,n,o){return new Promise(function(t){e.documentServices.menu.addItem(o.menuId,o.menuItem),e.documentServices.waitForChangesApplied(t)})},getById:function(e,t,n,o){return new Promise(function(t){var n=e.documentServices.menu.getById(o.menuId);e.documentServices.waitForChangesApplied(function(){t(n)})})}}}),define("platform/api/pagesGroup/pagesGroup",[],function(){"use strict";return{create:function(e,t,n,o){return new Promise(function(n){var i=e.documentServices.pagesGroup.create({groupName:o.groupName,appId:t.applicationId});e.documentServices.waitForChangesApplied(function(){n(i)})})},addPageToPagesGroup:function(e,t,n,o){return new Promise(function(t){e.documentServices.pagesGroup.addPageToPagesGroup(o.pagesGroupPointer,o.pageId),e.documentServices.waitForChangesApplied(t)})},getById:function(e,t,n,o){return e.documentServices.pagesGroup.getById(o.pagesGroupId)},getByGroupName:function(e,t,n,o){return e.documentServices.pagesGroup.getByGroupName(o.groupName)},getAll:function(e,t){return e.documentServices.pagesGroup.getAll(t.applicationId)},remove:function(e,t,n,o){return e.documentServices.pagesGroup.remove(o.pagesGroupPointer)}}}),define("platform/api/application/application",["lodash","experiment"],function(e,t){"use strict";return{install:function(n,o,i,r){return new Promise(function(o,i){e.get(r,"appDefinitionId")?t.isOpen("se_santaMembers")?n.documentServices.platform.provision(r.appDefinitionId,{origin:{type:"APP",info:{appDefinitionId:e.get(r,"initiatorAppDefinitionId")}}}).then(o,i):i():i(new Error("options must contain appDefinitionId"))})}}}),define("platform/api/internalAPIs",["lodash"],function(e){"use strict";return{addApp:function(t,n,o){t.wixCode.provision(e.noop,e.noop),t.documentServices.platform.initApp({appDefinitionId:e.get(o,"appDefinitionId"),editorUrl:e.get(o,"editorUrl"),viewerUrl:e.get(o,"viewerUrl")})}}}),define("platform/api/api",["lodash","platform/api/controllers/controllers","platform/api/editor/editor","platform/api/preview/preview","platform/api/vfs/vfs","platform/api/pages/pages","platform/api/components/components","platform/api/routers/routers","platform/api/history/history","platform/api/ide/ide","platform/api/info/info","platform/api/environment/environment","platform/api/siteSegments/siteSegments","platform/api/userPreferences/userPreferences","platform/api/tpa/tpa","platform/api/language/language","platform/api/menu/menu","platform/api/pagesGroup/pagesGroup","platform/api/application/application","platform/api/internalAPIs"],function(e,t,n,o,i,r,a,c,p,s,l,u,d,f,m,g,v,P,I,S){"use strict";var A={preview:o,controllers:t,vfs:i,components:a,routers:c,history:p,ide:s,pages:r,info:l,environment:u,userPreferences:f,tpa:m,menu:v,pagesGroup:P,language:g,siteSegments:d,application:I,__internal__:S};return A.editor=e.assign(n,A),A}),define("platform/services/platformPostMessageService",["lodash","pmrpc","coreUtilsLib","platform/common/constants"],function(e,t,n,o){"use strict";var i=function(t,o,i){e.isUndefined(t)||(o.event.eventPayload=n.objectUtils.cloneDeep(o.event.eventPayload),t.postMessage||(t=t.contentWindow),t.postMessage(o,i||"*"))};return{init:function(e,n){t.api.set(o.EDITOR_API_NS,n,{onApiCall:e.documentServices.platform.reportAPICallBI})},createPostMessageListener:function(e,t){return function(n){if(n.data.intent===o.PLATFORM_PANEL&&n.data.sourcePanel===t)switch(n.data.type){case o.PLATFORM_SDK_READY:i(n.source,{intent:o.PLATFORM_ON_EVENT,event:{eventType:"startConfiguration",eventPayload:e}});break;default:return}}}}}),define("platform/panels/appControllerDeleteConfirmationPanel.rt",["react","lodash","panels","baseUI"],function(e,t,n,o){"use strict";return function(){return e.createElement(n.frames.confirmationPanelFrame,{type:"important",panelName:"platform.panels.appControllerDeleteConfirmationPanel",onConfirm:this.props.onConfirm,confirmLabel:"PLATFORM_messages_delete",cancelLabel:"PLATFORM_messages_cancel_delete",panelTitle:this.getTitle()},e.createElement("div",{className:"icon"},e.createElement(o.symbol,{name:"deleteBlogConfirmationIcon"})),e.createElement("div",{className:"content"},e.createElement("p",{},this.getContentText())))}}),define("platform/panels/appControllerDeleteConfirmationPanel",["react","core","util","platform/panels/appControllerDeleteConfirmationPanel.rt"],function(e,t,n,o){"use strict";return e.createClass({displayName:"appControllerDeleteConfirmationPanel",mixins:[n.translationMixin,t.mixins.editorAPIMixin],propTypes:{controllerDisplayName:e.PropTypes.string,isSingleController:e.PropTypes.bool,onConfirm:e.PropTypes.func},getContentText:function(){var e=this.props.isSingleController?"PLATFORM_messages_delete_dataset_text":"PLATFORM_messages_multidelete_dataset_text";return this.translateTemplate(e,{appName:"Wix Database"},this.getEditorAPI())},getTitle:function(){var e=this.props.isSingleController?"PLATFORM_messages_delete_dataset_title":"PLATFORM_messages_multidelete_dataset_title";return this.translateTemplate(e,{appControllerName:this.props.controllerDisplayName},this.getEditorAPI())},render:o})}),define("platform/panels/warnForDisconnectedComponentsPanel.rt",["react","lodash","panels","baseUI"],function(e,t,n,o){"use strict";return function(){return e.createElement(n.frames.confirmationPanelFrame,{type:"important",panelName:"platform.panels.warnForDisconnectedComponentsPanel",onCancel:this.props.undo,confirmLabel:"PLATFORM_messages_continue",cancelLabel:"PLATFORM_messages_cancel",shouldCloseByDefaultOnConfirm:!0,panelTitle:this.getTitle()},e.createElement("div",{className:"icon"},e.createElement(o.symbol,{name:"platformWarning"})),this.props.connectedComps?e.createElement("div",{className:"content",key:"connectedCompsContent"},e.createElement("p",{},this.translateIfNeeded("PLATFORM_messages_move_connected_element_text_line1")),e.createElement("p",{},this.translateIfNeeded("PLATFORM_messages_move_connected_element_text_line2"))):null,this.props.connectedComps?null:e.createElement("div",{className:"content",key:"connectedDatasetContent"},e.createElement("p",{},this.translateIfNeeded("PLATFORM_messages_move_connected_dataset_text_line1")),e.createElement("p",{},this.translateIfNeeded("PLATFORM_messages_move_connected_dataset_text_line2"))))}}),define("platform/panels/warnForDisconnectedComponentsPanel",["react","lodash","util","platform/panels/warnForDisconnectedComponentsPanel.rt"],function(e,t,n,o){"use strict";return e.createClass({displayName:"warnForDisconnectedComponentsPanel",mixins:[n.translationMixin],propTypes:{undo:e.PropTypes.func.isRequired,connectedComps:e.PropTypes.bool.isRequired},getTitle:function(){var e=this.props.connectedComps?"PLATFORM_messages_move_connected_element_title":"PLATFORM_messages_move_connected_dataset_title";return this.translateIfNeeded(e)},render:o})}),define("platform",["lodash","platform/appController/appController","platform/connection/connection","platform/api/api","platform/services/platformPostMessageService","platform/services/tokenService","platform/common/constants","platform/common/utils","platform/panels/appControllerDeleteConfirmationPanel","platform/panels/warnForDisconnectedComponentsPanel"],function(e,t,n,o,i,r,a,c,p,s){"use strict";function l(r,a,c,p,s){var l=u(o,r),d=r.documentServices.platform.getAPIForSDK(l);t.init(r,c,s),n.init(a,p),i.init(r,d),r.documentServices.platform.init(l),r.registerSitePublishedCallbacks(function(t){var n=t.platform.getInstalledEditorApps();e.forEach(n,function(e){t.documentServices.platform.notifyApplication(e.applicationId,{eventType:"siteWasPublished"})})}.bind(this,r))}function u(t,n){return e.isFunction(t)?e.partial(t,n):e.isObject(t)?e.mapValues(t,function(e){return u(e,n)}):t}return{api:o,init:l,platformPostMessageService:i,tokenService:r,constants:a,utils:c,panels:{appControllerDeleteConfirmationPanel:p,warnForDisconnectedComponentsPanel:s}}});
//# sourceMappingURL=platform.min.js.map